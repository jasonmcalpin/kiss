# Feature: Resource Management

## User Story
As a player, I want to manage resources from planets I control so that I can build ships, expand production facilities, and construct wonders to strengthen my empire and achieve victory.

## Acceptance Criteria
- [ ] Player can view resources generated by controlled planets
- [ ] Player can allocate resources to different production activities
- [ ] Player can build ships using available resources
- [ ] Player can expand production facilities on planets
- [ ] Player can construct special buildings/wonders
- [ ] Player can trade resources with other players
- [ ] Resource generation is calculated each turn
- [ ] Resource storage has limits that can be expanded

## BDD Scenarios

### Scenario 1: Player Views Planet Resources
**Given** I control a planet called "Terra Prime"  
**And** the planet generates resources each turn  
**When** I click on Terra Prime  
**Then** I should see the planet's resource output  
**And** I should see "Energy: +50/turn"  
**And** I should see "Minerals: +30/turn"  
**And** I should see "Food: +20/turn"  
**And** I should see current stored amounts  

### Scenario 2: Player Builds Ships with Resources
**Given** I have 200 Energy and 100 Minerals stored  
**And** a Cruiser costs 150 Energy and 75 Minerals  
**When** I go to the shipyard on Terra Prime  
**And** I select "Build Cruiser"  
**And** I click "Confirm Build"  
**Then** the ship should be queued for construction  
**And** my resources should decrease to 50 Energy and 25 Minerals  
**And** I should see "Cruiser: 3 turns remaining" in build queue  

### Scenario 3: Player Expands Production Facilities
**Given** I control a planet with basic mining facilities  
**And** I have 300 Energy and 200 Minerals  
**When** I click "Build Structure"  
**And** I select "Advanced Mining Complex"  
**And** I confirm the construction  
**Then** the facility should be queued for construction  
**And** my resources should be deducted  
**And** once complete, mineral output should increase by +15/turn  

### Scenario 4: Player Constructs a Wonder
**Given** I have accumulated 1000 Energy, 800 Minerals, and 500 Food  
**And** I meet the prerequisites for "Galactic Trade Hub"  
**When** I go to "Special Projects"  
**And** I select "Galactic Trade Hub"  
**And** I review the benefits "+25% trade income empire-wide"  
**And** I click "Begin Construction"  
**Then** the wonder should start construction (10 turns)  
**And** my resources should be deducted  
**And** other players should be notified of my wonder project  

### Scenario 5: Resource Storage Limits Reached
**Given** my Energy storage capacity is 500  
**And** I currently have 480 Energy stored  
**And** my planets generate 50 Energy per turn  
**When** the turn processes  
**Then** my Energy should cap at 500 (storage limit)  
**And** I should see a warning "Energy storage full - 30 Energy wasted"  
**And** I should be prompted to build more storage or spend resources  

### Scenario 6: Player Trades Resources
**Given** I have excess Energy but need Minerals  
**And** the galactic market is available  
**When** I go to "Trade Market"  
**And** I offer 200 Energy for 100 Minerals  
**And** I set the trade ratio to 2:1  
**And** I click "Post Trade Offer"  
**Then** my trade offer should appear on the market  
**And** other players should be able to accept it  
**And** my Energy should be held in escrow until trade completes  

### Scenario 7: Insufficient Resources for Construction
**Given** I want to build a Battleship  
**And** a Battleship costs 500 Energy and 300 Minerals  
**But** I only have 400 Energy and 200 Minerals  
**When** I try to build the Battleship  
**Then** I should see "Insufficient resources" error  
**And** the build button should be disabled  
**And** I should see exactly what resources I'm missing  

### Scenario 8: Resource Production Bonus from Research
**Given** I have researched "Advanced Mining Technology"  
**And** the technology provides +20% mineral production  
**When** the turn processes  
**And** my base mineral production is 100/turn  
**Then** I should receive 120 minerals this turn  
**And** the bonus should be clearly indicated in the resource display  

## Implementation Notes

### Database Requirements
- planet_resources table: planet_id, resource_type, base_production, bonus_production, storage_capacity, current_amount
- resource_types table: id, name, description, base_storage_limit
- construction_queue table: planet_id, item_type, item_id, cost_paid, turns_remaining, completion_turn
- trade_offers table: player_id, offered_resource, offered_amount, requested_resource, requested_amount, status

### API Endpoints
- GET /api/planets/{id}/resources - Get planet resource information
- POST /api/construction/ships - Queue ship construction
- POST /api/construction/buildings - Queue building construction
- POST /api/construction/wonders - Start wonder construction
- GET /api/trade/market - View trade market
- POST /api/trade/offers - Create trade offer
- PUT /api/trade/offers/{id}/accept - Accept trade offer

### Frontend Components
- Planet resource overview panel
- Construction queue interface
- Shipyard with available ship types and costs
- Building construction menu
- Wonder/special projects interface
- Trade market interface
- Resource storage indicators with capacity warnings

### Resource Types
- **Energy**: Powers ships and facilities, used for most constructions
- **Minerals**: Raw materials for ships and buildings
- **Food**: Supports population growth and some special units
- **Research Points**: Generated by research facilities, used for technology
- **Trade Goods**: Generated by commercial buildings, provides income

## Status
- [ ] Database schema for resources and construction
- [ ] Resource generation calculation system
- [ ] Ship construction API and interface
- [ ] Building construction API and interface
- [ ] Wonder construction system
- [ ] Trade market system
- [ ] Resource storage and capacity management
- [ ] Construction queue management
- [ ] Resource bonus calculation from research/buildings
- [ ] Tests written
- [ ] Feature complete
