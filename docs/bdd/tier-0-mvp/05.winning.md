# Feature: Victory Conditions

## User Story
As a player, I want to achieve victory by claiming the most planets or accumulating the most resources so that I can win the game either solo or as part of a team alliance.

## Acceptance Criteria
- [ ] Player can win by controlling the most planets at game end
- [ ] Player can win by accumulating the most total resources
- [ ] Players can form teams and achieve team victory
- [ ] Victory conditions are clearly displayed during gameplay
- [ ] Game ends automatically when victory conditions are met
- [ ] Victory announcement shows winner(s) and final scores
- [ ] Players can view victory progress throughout the game
- [ ] Multiple victory conditions can be enabled simultaneously

## BDD Scenarios

### Scenario 1: Solo Victory by Planet Control
**Given** the game is set to end after 20 turns  
**And** victory condition is "Most Planets Controlled"  
**And** I control 15 planets  
**And** Admiral Smith controls 12 planets  
**And** Captain Jones controls 8 planets  
**When** turn 20 is completed  
**Then** I should be declared the winner  
**And** I should see "Victory! You controlled the most planets (15)"  
**And** all players should see the final planet control standings  

### Scenario 2: Solo Victory by Resource Accumulation
**Given** the victory condition is "Most Total Resources"  
**And** the game ends when someone reaches 10,000 total resource value  
**And** I have accumulated 7,500 Energy + 2,000 Minerals + 500 Food = 10,000 total  
**When** my turn ends  
**Then** the game should immediately end  
**And** I should see "Victory! You reached the resource target first"  
**And** other players should be notified of my victory  

### Scenario 3: Team Victory Achievement
**Given** I am in a team alliance with Captain Jones  
**And** the victory condition is "Team Planet Control"  
**And** together we control 18 planets (I have 10, Captain Jones has 8)  
**And** Admiral Smith controls 12 planets solo  
**When** the game ends  
**Then** both Captain Jones and I should be declared winners  
**And** we should see "Team Victory! Your alliance controlled the most planets"  
**And** our combined score should be displayed  

### Scenario 4: Player Views Victory Progress
**Given** the victory condition is "Control 20 planets"  
**And** I currently control 14 planets  
**When** I check the victory status  
**Then** I should see "Victory Progress: 14/20 planets controlled"  
**And** I should see a progress bar showing 70% completion  
**And** I should see other players' progress as well  

### Scenario 5: Multiple Victory Conditions Active
**Given** the game has both "Most Planets" and "Resource Target" victory conditions  
**And** I am close to the resource target (9,500/10,000)  
**And** Admiral Smith is leading in planets (16 vs my 12)  
**When** I reach 10,000 resources first  
**Then** I should win immediately via resource victory  
**And** the planet control victory should be ignored  
**And** the victory message should specify "Resource Victory"  

### Scenario 6: Victory Condition Changes During Game
**Given** the game started with "Most Planets" victory condition  
**And** all players vote to change to "Resource Target" victory  
**When** the vote passes  
**Then** all players should be notified of the change  
**And** the victory progress should update to show resource targets  
**And** previous planet control progress should be saved but not active  

### Scenario 7: Tie in Victory Conditions
**Given** the victory condition is "Most Planets"  
**And** both I and Admiral Smith control 15 planets each  
**And** the game timer expires  
**When** victory is calculated  
**Then** both players should be declared co-winners  
**And** we should see "Tie Game! Multiple players achieved victory"  
**And** the final standings should show the tie clearly  

### Scenario 8: Player Eliminated Before Victory
**Given** I was eliminated from the game 5 turns ago  
**And** the remaining players are competing for victory  
**When** Admiral Smith achieves the victory condition  
**Then** I should see "Admiral Smith has won the game"  
**And** I should see my final ranking as "Eliminated - Turn 15"  
**And** I should be able to view the complete game results  

### Scenario 9: Team Member Leaves Alliance Before Victory
**Given** I was in a team alliance with Captain Jones  
**And** we were close to team victory  
**But** Captain Jones left the alliance 2 turns ago  
**When** victory conditions are checked  
**Then** we should be evaluated as individual players  
**And** our previous team progress should not count  
**And** only individual victory conditions should apply  

### Scenario 10: Victory Condition Warning
**Given** Admiral Smith is 1 planet away from victory (19/20 planets)  
**When** the turn begins  
**Then** all players should see a warning "Admiral Smith is close to victory!"  
**And** the warning should specify "1 planet needed for victory"  
**And** players should be encouraged to take action to prevent the victory  

## Implementation Notes

### Database Requirements
- victory_conditions table: game_id, condition_type, target_value, is_active, team_based
- victory_progress table: game_id, player_id, condition_type, current_value, last_updated
- game_results table: game_id, winner_ids, victory_type, final_scores, end_time
- team_alliances table: game_id, team_id, player_id, joined_at, left_at

### API Endpoints
- GET /api/games/{id}/victory - Get victory conditions and progress
- POST /api/games/{id}/victory/check - Check if victory conditions are met
- GET /api/games/{id}/results - Get final game results
- POST /api/games/{id}/teams - Form team alliance
- DELETE /api/games/{id}/teams/{id} - Leave team alliance

### Frontend Components
- Victory progress dashboard showing all conditions
- Victory condition selector (for game setup)
- Team alliance management interface
- Victory warning notifications
- Final victory/results screen
- Victory progress indicators in main game UI

### Victory Condition Types
- **Planet Control**: Control X planets or most planets at game end
- **Resource Target**: Accumulate X total resource value
- **Economic Victory**: Generate X resources per turn
- **Military Victory**: Destroy X enemy ships/planets
- **Wonder Victory**: Complete X wonder projects
- **Time Victory**: Most points when time limit reached

### Team Victory Rules
- Teams share victory conditions
- Team members' progress is combined
- All team members win together
- Players can leave teams (with penalties)
- Team formation requires mutual agreement

## Status
- [ ] Database schema for victory conditions
- [ ] Victory condition checking system
- [ ] Victory progress tracking
- [ ] Team alliance system
- [ ] Victory notification system
- [ ] Final results calculation
- [ ] Frontend victory progress display
- [ ] Victory condition configuration
- [ ] Team management interface
- [ ] Tests written
- [ ] Feature complete
